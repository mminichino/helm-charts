# Default RDI values in YAML format.
# Variables to template configuration.

global:
  # DO NOT modify this value.
  vmMode: false

  # Indicates whether the deployment is intended for an OpenShift environment.
  openShift: false

  # Global log level, one of TRACE, DEBUG, INFO, WARNING, ERROR, CRITICAL.
  # If specific component log levels are not set, this value will be used.
  logLevel: INFO

  # Global image settings.
  # If using a private image registry, update the default values accordingly.
  image:
    # Docker image registry.
    registry: docker.io

    # Docker image repository.
    repository: redis

    # Docker image tag.
    tag: 1.15.0

  # Image pull secrets to be used when using a private image registry.
  # imagePullSecrets:
  #   - name: pullSecret1

  # Container default security context.
  # ref: https://kubernetes.io/docs/tasks/configure-pod-container/security-context/#set-the-security-context-for-a-container
  securityContext:
    runAsNonRoot: true
    # On OpenShift, user and group 1000 are usually not allowed.
    # If using OpenShift, set runAsUser and runAsGroup to values in your project's user and group ranges.
    # You can examine the latter via `oc get project <rid-project-name> -o yaml | grep "openshift.io/sa.scc"`
    runAsUser: 1000
    runAsGroup: 1000
    allowPrivilegeEscalation: false

  # Custom labels and annotations for all RDI resources.
  # labels:
    # foo: bar
  # annotations:
    # foo: bar

  # Set to 'false' if you prefer to manually create the `rdi-db-ssl` and `rdi-sys-config` secrets.
  # Make sure to create these secrets before installing this Helm chart.
  # Refer to their corresponding templates for the keys that RDI expects to find in them.
  createSecrets: true

  # External secrets configuration.
  externalSecrets:
    # DO NOT modify this value.
    enabled: false

# Configuration of the RDI Redis database connection
connection:
  # The hostname or IP of the RDI Redis database.
  # host: ""

  # The port of the RDI Redis database.
  # port: ""

  # Username and password for the RDI Redis database.
  # If using the default password, the username should be an empty string.
  username: ""
  # password: ""

  ssl:
    # Set to `true` when using TLS or mTLS for the RDI Redis database connection.
    enabled: false

    # CA certificate PEM file content (required for both TLS and mTLS).
    # cacert: ""

    # Certificate PEM file content (required only for mTLS).
    # cert: ""

    # Private key PEM file content (required only for mTLS).
    # key: ""

    # Passphrase for decrypting the private key, if the key is encrypted.
    # keyPassword: ""

# Configuration of the reloader.
# Set `isOpenshift` to `true` if deploying on OpenShift.
reloader:
  reloader:
    watchGlobally: false
    isOpenshift: false
    deployment:
      containerSecurityContext:
        allowPrivilegeEscalation: false
        capabilities:
          drop:
            - ALL
      securityContext:
        runAsUser: null
      # Custom labels and annotations for the reloader deployment and pods.
      # labels: {}
      # annotations: {}
    # serviceAccount:
      # Custom labels and annotations for the reloader service account.
      # labels: {}
      # annotations: {}
    # rbac:
      # Custom labels and annotations for the reloader RBAC resources.
      # labels: {}
      # annotations: {}
  fullnameOverride: rdi-reloader

# Configuration of the RDI Operator.
operator:
  # Operator image settings.
  image:
    name: rdi-operator

    # Image pull policy.
    # ref: https://kubernetes.io/docs/concepts/containers/images/#pre-pulled-images
    pullPolicy: IfNotPresent

  # Operator leader election configuration
  # leaderElection:
    # Set to `true` to enable the leader election.
    # enabled: false

    # Type of the leader election lease, must be 'redsync' or 'gcs'.
    # leaseType: redsync

    # Redsync lease configuration.
    # redsyncLease:
      # Name of the Redis key of the Redsync mutex.
      # keyName: rdi:ha:lock

    # GCS lease configuration, must be specified if the lease type is 'gcs'.
    # gcsLease:
      # Name of the GCS bucket.
      # bucketName: example-bucket

      # Name of the GCS object.
      # objectName: example-object

    # Unique identifier of the instance.
    # instanceID: cluster-1

    # Set to `true` to enable standby mode. In standby mode, the operator will not participate
    # in the leader election and will lose the leadership if already a leader.
    # standbyMode: false

    # Lease time-to-live.
    # ttl: 60s

    # Interval between attempts to acquire or extend the lease.
    # refreshInterval: 10s

    # Total timeout for lease operations, should be less than the lease TTL, minus the check timeout, minus the refresh interval.
    # timeout: 30s

    # Retry policy for lease operations.
    # retryPolicy:
      # Number of attempts for lease operations.
      # attempts: 3

      # Initial interval between attempts.
      # initialInterval: 1s

      # Factor by which the interval increases after each attempt.
      # backoffFactor: 2.0

    # Total timeout for leadership condition checks, should be less than the lease TTL, minus the lease timeout, minus the refresh interval.
    # checkTimeout: 15s

    # Retry policy for leadership condition checks.
    # checkRetryPolicy:
      # Number of attempts for leadership condition checks.
      # attempts: 3

      # Initial interval between attempts.
      # initialInterval: 1s

      # Factor by which the interval increases after each attempt.
      # backoffFactor: 2.0

  # Operator log level, one of TRACE, DEBUG, INFO, WARNING, ERROR, CRITICAL.
  # If not set, global.loglevel will be used.
  # logLevel: INFO

  # Custom labels and annotations for Operator deployment and pods.
  # labels:
    # foo: bar
  # annotations:
    # foo: bar

  # Operator container resources
  # resources:
    # limits:
      # cpu: 500m
      # memory: 128Mi
    # requests:
      # cpu: 10m
      # memory: 64Mi

  # Operator container liveness, readiness, and startup probe parameters.
  # ref: https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/
  liveness:
    failureThreshold: 3
    periodSeconds: 20
  readiness:
    failureThreshold: 3
    periodSeconds: 10
  startup:
    failureThreshold: 24
    periodSeconds: 5

  # Operator ServiceAccount resources configuration.
  # serviceAccount:
    # Set to false to disable the creation of ServiceAccount resources.
    # enabled: true

    # Additional ServiceAccount resources labels and annotations.
    # labels: {}
    # annotations: {}

  # Operator RBAC resources (Role, RoleBinding, ClusterRole, ClusterRoleBinding) configuration.
  # rbac:
    # Set to false to disable the creation of RBAC resources.
    # enabled: true

    # Additional RBAC resources labels and annotations.
    # labels: {}
    # annotations: {}

  # Operator CRD resources configuration.
  # crd:
    # Set to false to disable the creation of CRD resources.
    # enabled: true

    # Enabling this option adds the "helm.sh/resource-policy": keep
    # annotation to the CRDs, ensuring they remain installed even when
    # the Helm release is uninstalled.
    # NOTE: Removing the CRDs will also remove all cert-manager CR(s)
    # (Certificates, Issuers, ...) due to garbage collection.
    # keep: false

    # Additional CRD resources labels and annotations.
    # labels: {}
    # annotations: {}

  # Operator metrics configuration.
  # metrics:
    # Set to false to disable the metrics and their associated resources.
    # enabled: true

    # Additional metrics service labels and annotations.
    # labels: {}
    # annotations: {}

  # Operator webhooks configuration.
  # webhooks:
    # Set to true to enable the webhooks and their associated resources.
    # If webhooks are enabled, either certificate management jobs or cert-manager must be enabled, but not both.
    # enabled: false

    # Additional webhook service labels and annotations.
    # labels: {}
    # annotations: {}

  # Operator metrics ingress configuration.
  # ingress:
    # Set to true to create an Ingress resource for the Operator metrics service.
    # enabled: false

    # Operator metrics ingress class name.
    # If not specified, the default ingress class will be used if defined in your cluster.
    # className: "alb"

    # Operator metrics ingress hosts.
    # If specified, the Ingress resource will match only these hosts, otherwise it will match all hosts.
    # hosts:
      # - example.com

    # Path prefix for the Operator metrics ingress path.
    # pathPrefix: "/operator"

    # Additional Operator metrics ingress labels and annotations
    # labels: {}
    # annotations: {}

  # Operator cert-manager (https://cert-manager.io/) resources configuration.
  # certmanager:
    # Set to true to enable the certificate management by cert-manager.
    # This option has no effect if webhooks are disabled.
    # If enabled, certificate management jobs must be disabled.
    # enabled: false

    # Additional cert-manager resources labels and annotations.
    # labels: {}
    # annotations: {}

  # Operator certificate management jobs configuration.
  # certJobs:
    # Set to true to enable the certificate management jobs.
    # This option has no effect if webhooks are disabled.
    # If enabled, cert-manager must be disabled.
    # enabled: false

    # Certificate management jobs parameters.
    # backoffLimit: 3
    # activeDeadlineSeconds: 90

    # Additional certificate management jobs labels and annotations.
    # labels: {}
    # annotations: {}

  # Configuration of the RDI data plane components (Collector, Collector API, Processor)
  dataPlane:
    # Configuration of the Collector (Debezium)
    collector:
      # Collector image settings.
      # If using a private image registry, update the default values accordingly.
      image:
        # Docker image registry.
        registry: docker.io

        # Docker image repository.
        repository: redislabs/debezium-server

        # Docker image tag.
        tag: 3.0.8.Final-rdi.1

      # Custom labels and annotations for Collector deployment and pods.
      # labels:
        # foo: bar
      # annotations:
        # foo: bar

      # Configuration of the Collector metrics service.
      # By default it is set to ClusterIP, allowing access only from within the cluster.
      # ref: http://kubernetes.io/docs/user-guide/services/
      # service:
        # type: ClusterIP
        # port: 9092

        # Custom labels and annotations for Collector metrics service.
        # labels:
          # foo: bar
        # annotations:
          # foo: bar

      # Configuration of the Collector ServiceMonitor, which is used to scrape metrics from the Collector metrics service.
      # serviceMonitor:
        # Set to `true` to activate the ServiceMonitor.
        # enabled: false

        # Custom labels and annotations for Collector ServiceMonitor resource.
        # Typically, you would want to set the `release` label to match your Prometheus configuration.
        # labels:
          # release: prometheus
        # annotations:
          # foo: bar

      # Configuration of the Collector service account.
      # serviceAccount:
        # Set to `false` to deactivate the service account creation.
        # enabled: true

        # Custom labels and annotations for Collector service account.
        # labels:
          # foo: bar
        # annotations:
          # foo: bar

      # Configuration of the Collector metrics ingress.
      # ingress:
        # Set to `true` to create an Ingress resource for the Collector metrics service.
        # enabled: false

        # Collector metrics ingress class name.
        # If not specified, the default ingress class will be used if defined in your cluster.
        # className: alb

        # Collector metrics ingress hosts.
        # If specified, the Ingress resource will match only these hosts, otherwise it will match all hosts.
        # You can use the `$SOURCE` variable to include the source name in the host.
        # hosts:
          # - collector-$SOURCE.example.com

        # Path prefix for the Collector metrics ingress path.
        # You can use the `$SOURCE` variable to include the source name in the path prefix.
        # pathPrefix: "/collector-$SOURCE"

        # Custom labels and annotations for the Collector metrics ingress.
        # labels:
          # foo: bar
        # annotations:
          # alb.ingress.kubernetes.io/target-type: ip

    # Configuration for the Collector API
    # collectorApi:
      # Specifies whether the Collector API should be deployed.
      # enabled: true

      # Custom labels and annotations for the Collector API deployment and pods.
      # labels:
        # foo: bar
      # annotations:
        # foo: bar

      # Configuration of the Collector API service.
      # service:
        # Custom labels and annotations for Collector API service.
        # labels:
          # foo: bar
        # annotations:
          # foo: bar

    # Configuration of the Processor.
    # processor:
      # Processor log level, one of TRACE, DEBUG, INFO, WARNING, ERROR, CRITICAL.
      # If not set, global.loglevel will be used.
      # logLevel: INFO

      # Custom labels and annotations for the Processor deployment and pods.
      # labels:
        # foo: bar
      # annotations:
        # foo: bar

    # Configuration of the reset operation jobs.
    # jobs:
      # CLI log level, one of TRACE, DEBUG, INFO, WARNING, ERROR, CRITICAL.
      # If not set, global.loglevel will be used.
      # logLevel: INFO

      # Custom labels and annotations for the reset operation jobs.
      # labels:
        # foo: bar
      # annotations:
        # foo: bar

    # Configuration of the Flink Collector.
    # flinkCollector:
      # Set to `false` to disable the Flink Collector.
      # enabled: true

      # Configuration of the Flink Collector JobManager.
      # jobManager:

        # Custom labels and annotations for the Flink Collector JobManager deployment and pods.
        # labels:
          # foo: bar
        # annotations:
          # foo: bar

        # Flink Collector JobManager memory in MB.
        # memory: 1600

        # Configuration of the Flink Collector JobManager service.
        # service:
          # type: ClusterIP

          # Custom labels and annotations for Flink Collector JobManager service.
          # labels:
            # foo: bar
          # annotations:
            # foo: bar

        # Configuration of the Flink Collector JobManager ServiceMonitor resource.
        # serviceMonitor:
          # Set to `true` to activate the ServiceMonitor.
          # enabled: false

          # Custom labels and annotations for Flink Collector JobManager ServiceMonitor resource.
          # Typically, you would want to set the `release` label to match your Prometheus configuration.
          # labels:
            # release: prometheus
          # annotations:
            # foo: bar

      # Configuration of the Flink Collector TaskManager.
      # taskManager:
        # Flink Collector TaskManager replicas.
        # replicas: 2

        # Custom labels and annotations for the Flink Collector TaskManager deployment and pods.
        # labels:
          # foo: bar
        # annotations:
          # foo: bar

        # Flink Collector TaskManager memory in MB.
        # memory: 1728

        # Configuration of the Flink Collector TaskManager service.
        # service:
          # type: ClusterIP

          # Custom labels and annotations for Flink Collector TaskManager service.
          # labels:
            # foo: bar
          # annotations:
            # foo: bar

        # Configuration of the Flink Collector TaskManager ServiceMonitor resource.
        # serviceMonitor:
          # Set to `true` to activate the ServiceMonitor.
          # enabled: false

          # Custom labels and annotations for Flink Collector TaskManager ServiceMonitor resource.
          # Typically, you would want to set the `release` label to match your Prometheus configuration.
          # labels:
            # release: prometheus
          # annotations:
            # foo: bar

      # Configuration of the Flink Collector ingress.
      # ingress:
        # Set to `true` to create an Ingress resource for the Flink Collector.
        # enabled: false

        # Flink Collector ingress class name.
        # If not specified, the default ingress class will be used if defined in your cluster.
        # className: alb

        # Flink Collector metrics ingress hosts.
        # If specified, the Ingress resource will match only these hosts, otherwise it will match all hosts.
        # You can use the `$SOURCE` variable to include the source name in the host.
        # hosts:
          # - collector-$SOURCE.example.com

        # Path prefix for the Flink Collector Web UI and metrics ingress paths.
        # You can use the `$SOURCE` variable to include the source name in the path prefix.
        # pathPrefix: "/collector-$SOURCE"

        # Custom labels and annotations for the Flink Collector ingress.
        # labels:
          # foo: bar
        # annotations:
          # alb.ingress.kubernetes.io/target-type: ip

      # Configuration of the Flink Collector Metrics Aggregator sidecar.
      # metricsAggregator:
        # Set to `true` to enable the Metrics Aggregator sidecar.
        # If enabled, the JobManager Ingress will expose aggregated metrics.
        # enabled: false

        # Metrics Aggregator log level, one of TRACE, DEBUG, INFO, WARNING, ERROR, CRITICAL.
        # If not set, global.loglevel will be used.
        # logLevel: INFO

# Configuration of Fluentd.
fluentd:
  # Fluentd image settings.
  image:
    name: rdi-fluentd

    # Image pull policy.
    # ref: https://kubernetes.io/docs/concepts/containers/images/#pre-pulled-images
    pullPolicy: IfNotPresent

  rdiLogsHostPath: "/opt/rdi/logs"
  podLogsHostPath: "/var/log/pods"
  logrotateMinutes: "5"

# Configuration of the RDI Metrics Exporter.
rdiMetricsExporter:
  # Metrics Exporter image settings.
  image:
    name: rdi-monitor

    # Image pull policy.
    # ref: https://kubernetes.io/docs/concepts/containers/images/#pre-pulled-images
    pullPolicy: IfNotPresent

  # Custom labels and annotations for the Metrics Exporter deployment and pods.
  # labels:
    # foo: bar
  # annotations:
    # foo: bar

  # Configuration of the Metrics Exporter service.
  # By default it is set to ClusterIP, allowing access only from within the cluster.
  # ref: http://kubernetes.io/docs/user-guide/services/
  service:
    type: ClusterIP
    port: 9121

    # Custom labels and annotations for the Metrics Exporter service resource.
    # labels:
      # foo: bar
    # annotations:
      # foo: bar

  # Metrics Exporter container liveness, readiness, and startup probe parameters.
  # ref: https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-probes/#configure-probes
  liveness:
    failureThreshold: 6
    periodSeconds: 10
  readiness:
    failureThreshold: 6
    periodSeconds: 30
  startup:
    failureThreshold: 60
    periodSeconds: 5

  # Configuration of the ServiceMonitor, which is used to scrape metrics from the Metrics Exporter service.
  serviceMonitor:
    # Set to `true` to activate the ServiceMonitor.
    enabled: false

    # Custom labels and annotations for the Metrics Exporter ServiceMonitor resource.
    # Typically, you would want to set the `release` label to match your Prometheus configuration.
    # labels:
      # release: prometheus
    # annotations:
      # foo: bar

  # Configuration of the Metrics Exporter ingress.
  ingress:
    # Set to `true` to create an Ingress resource for the Metrics Exporter service.
    enabled: false

    # Metrics Exporter ingress class name.
    # If not specified, the default ingress class will be used if defined in your cluster.
    # className: alb

    # Metrics Exporter ingress hosts.
    # If specified, the Ingress resource will match only these hosts, otherwise it will match all hosts.
    # hosts:
      # - example.com

    # Path prefix for the Metrics Exporter ingress path.
    pathPrefix: ""

    # Custom labels and annotations for the Metrics Exporter Ingress resource.
    # labels:
      # foo: bar
    # annotations:
      # alb.ingress.kubernetes.io/target-type: ip

# Configuration of the RDI API.
api:
  # API image settings.
  image:
    name: rdi-api

    # Image pull policy.
    # ref: https://kubernetes.io/docs/concepts/containers/images/#pre-pulled-images
    pullPolicy: IfNotPresent

  # Custom labels and annotations for the API deployment and pods.
  # labels:
    # foo: bar
  # annotations:
    # foo: bar

  # Set to `false` to disable the authentication for the RDI API.
  # authEnabled: true

  # The key used to encrypt the JWT token used by RDI API. Best practice is for this
  # to contain 32 ASCII characters (equivalent to 256 bits of data).
  jwtKey: "replace_on_install"

  # API log level, one of TRACE, DEBUG, INFO, WARNING, ERROR, CRITICAL.
  # If not set, global.loglevel will be used.
  # logLevel: INFO

  # Configuration of the API service.
  # By default, it is set to ClusterIP, allowing access only from within the cluster.
  # ref: http://kubernetes.io/docs/user-guide/services/
  service:
    type: ClusterIP
    port: 8080
    targetPort: 8081

    # Custom labels and annotations for the API service resource.
    # labels:
      # foo: bar
    # annotations:
      # foo: bar

  # API container liveness, readiness, and startup probe parameters.
  # ref: https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-probes/#configure-probes
  liveness:
    failureThreshold: 6
    periodSeconds: 10
  readiness:
    failureThreshold: 6
    periodSeconds: 30
  startup:
    failureThreshold: 60
    periodSeconds: 5

  # Timeout for the communication between the API and the Collector API.
  # collectorApiTimeout: 30

# Configuration of the RDI API Ingress resource used to expose the RDI API service to be accessed from outside the cluster.
# ref: http://kubernetes.io/docs/user-guide/services/
ingress:
  # Set to `true` to enable the Ingress resource.
  enabled: false

  # Ingress class name, see https://kubernetes.io/docs/concepts/services-networking/ingress/#ingress-class.
  # If not specified, the default ingress class will be used if defined in your cluster.
  # Use `kubectl get ingressclass` to examine existing ingress classes.
  # className: alb

  # Ingress hosts.
  # If specified, the Ingress resource will match only these hosts, otherwise it will match all hosts.
  # hosts:
    # - example.com

  # Path prefix for the ingress path.
  pathPrefix: ""

  # Custom labels and annotations for the Ingress resource.
  # labels:
    # foo: bar
  # annotations:
    # kubernetes.io/ingress.class: "nginx"
    # nginx.ingress.kubernetes.io/rewrite-target: /

  # Ingress resource TLS configuration.
  tls:
    # Set to `true` to enable TLS for the Ingress resource.
    enabled: false

    # When `enabled` is set to `true`, set this property to the content of the crt file.
    # crt: ""

    # When `enabled` is set to `true`, set this property to the content of the key file.
    # key: ""

# Configuration of the RDI API Route resource used to expose the RDI API service to be accessed from outside the cluster
# in an OpenShift environment.
route:
  # Set to `true` to enable the Route resource.
  enabled: false

  # Route resource TLS configuration.
  tls:
    # Set to `true` to enable TLS for the Route resource.
    enabled: false

    # Certificate PEM file content (required if `enabled` is set to `true`).
    # crt: ""

    # Private key PEM file content (required if `enabled` is set to `true`).
    # key: ""
